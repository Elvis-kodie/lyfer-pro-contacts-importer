<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LYFER PROCONTACT IMPORTER</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.0.0/dist/tesseract.min.js"></script>
    <style>
        body {
            background: linear-gradient(to bottom right, #f3f4f6, #e5e7eb);
            min-height: 100vh;
            font-size: 16px; /* Base font size for mobile */
        }
        .container {
            max-width: 100%;
            padding: 0.5rem; /* Reduced padding for mobile */
        }
        .header {
            background: linear-gradient(135deg, #1e3a8a, #1e293b);
            color: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            text-align: center;
            margin-bottom: 1rem;
            position: relative;
            overflow: hidden;
        }
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 20%, rgba(255, 255, 255, 0.2), transparent 50%);
            opacity: 0.5;
        }
        .header h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem; /* Smaller header for mobile */
            font-weight: 700;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            animation: scaleIn 0.6s ease-out;
            position: relative;
        }
        @keyframes scaleIn {
            0% { transform: scale(0.9); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
        .header p {
            font-size: 0.875rem; /* Smaller subtitle */
            color: #e5e7eb;
            margin-top: 0.5rem;
            position: relative;
        }
        textarea {
            resize: vertical;
            min-height: 150px; /* Smaller textarea height */
            font-size: 0.875rem;
        }
        .btn-primary {
            transition: transform 0.2s, background-color 0.3s;
            padding: 0.75rem; /* Larger touch target */
        }
        .btn-primary:hover {
            transform: scale(1.05);
            background-color: #2563eb;
        }
        .output {
            transition: opacity 0.3s;
            font-size: 0.875rem;
        }
        .example-box {
            background: #f9fafb;
            border-left: 4px solid #3b82f6;
            padding: 0.75rem;
        }
        .custom-select {
            position: relative;
            width: 100%;
        }
        .custom-select-button {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            background: white;
            cursor: pointer;
            font-size: 0.875rem;
        }
        .custom-select-button img {
            width: 20px;
            height: 13px;
            margin-right: 6px;
        }
        .custom-select-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            max-height: 250px;
            overflow-y: auto;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }
        .custom-select-dropdown.show {
            display: block;
        }
        .custom-select-option {
            display: flex;
            align-items: center;
            padding: 0.5rem 0.75rem;
            cursor: pointer;
            font-size: 0.875rem;
        }
        .custom-select-option:hover {
            background: #f3f4f6;
        }
        .custom-select-option img {
            width: 20px;
            height: 13px;
            margin-right: 6px;
        }
        .chatbot-container {
            position: fixed;
            bottom: 10px;
            right: 10px;
            z-index: 1000;
        }
        .chatbot-toggle {
            background: #3b82f6;
            color: white;
            padding: 0.75rem;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s;
        }
        .chatbot-toggle:hover {
            transform: scale(1.1);
        }
        .chatbot-window {
            display: none;
            width: 90vw; /* Full width on mobile */
            max-height: 80vh;
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        .chatbot-window.show {
            display: block;
        }
        .chatbot-header {
            background: #1e3a8a;
            color: white;
            padding: 0.5rem;
            font-weight: 600;
            font-size: 0.875rem;
        }
        .chatbot-messages {
            max-height: 60vh;
            overflow-y: auto;
            padding: 0.75rem;
            background: #f9fafb;
            font-size: 0.875rem;
        }
        .chatbot-message {
            margin-bottom: 0.75rem;
            padding: 0.5rem;
            border-radius: 0.25rem;
        }
        .chatbot-message.user {
            background: #3b82f6;
            color: white;
            margin-left: 1.5rem;
            text-align: right;
        }
        .chatbot-message.bot {
            background: #e5e7eb;
            color: #1f2937;
            margin-right: 1.5rem;
        }
        .chatbot-input {
            display: flex;
            border-top: 1px solid #d1d5db;
        }
        .chatbot-input input {
            flex-grow: 1;
            padding: 0.5rem;
            border: none;
            outline: none;
            font-size: 0.875rem;
        }
        .chatbot-input button {
            background: #3b82f6;
            color: white;
            padding: 0.5rem 0.75rem;
            border: none;
            cursor: pointer;
        }
        .chatbot-input button:hover {
            background: #2563eb;
        }
        .footer {
            text-align: center;
            padding: 0.75rem;
            color: #6b7280;
            font-size: 0.75rem;
            margin-top: 1rem;
        }
        .image-upload-container {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }
        .image-upload-label {
            display: inline-block;
            padding: 0.5rem 0.75rem;
            background: #e5e7eb;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 0.875rem;
        }
        .image-upload-label:hover {
            background: #d1d5db;
        }
        .image-upload-input {
            display: none;
        }
        .image-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .image-preview-item {
            position: relative;
            max-width: 80px; /* Smaller previews for mobile */
        }
        .image-preview {
            max-width: 100%;
            max-height: 80px;
            border-radius: 0.5rem;
            cursor: pointer;
        }
        .delete-button {
            position: absolute;
            top: 3px;
            right: 3px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s;
            font-size: 0.75rem;
        }
        .delete-button:hover {
            transform: scale(1.1);
            background: #dc2626;
        }
        .upload-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        .modal.show {
            display: flex;
        }
        .modal img {
            max-width: 95%;
            max-height: 95%;
            border-radius: 0.5rem;
        }
        .modal-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1rem;
        }
        .modal-close:hover {
            background: #dc2626;
        }
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 3000;
            justify-content: center;
            align-items: center;
        }
        .loading-overlay.show {
            display: flex;
        }
        .loading-content {
            background: white;
            padding: 1rem;
            border-radius: 0.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }
        .spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Ensure Tailwind classes are mobile-friendly */
        @media (max-width: 640px) {
            .container {
                padding: 0.5rem;
            }
            .shadow-lg {
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
            .p-6 {
                padding: 1rem;
            }
            .mb-8 {
                margin-bottom: 1.5rem;
            }
            .text-xl {
                font-size: 1.125rem;
            }
            .text-gray-600 {
                font-size: 0.875rem;
            }
            .mb-4 {
                margin-bottom: 0.75rem;
            }
            .py-3 {
                padding-top: 0.5rem;
                padding-bottom: 0.5rem;
            }
            .px-4 {
                padding-left: 0.75rem;
                padding-right: 0.75rem;
            }
            pre {
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body class="flex items-center justify-center p-4">
    <div class="container mx-auto">
        <div class="header">
            <h1>LYFER PROCONTACT IMPORTER</h1>
            <p>Effortlessly import up to 1000 contacts to your iPhone or Android with a single click.</p>
        </div>
        <div class="bg-white shadow-lg rounded-lg p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">How It Works</h2>
            <p class="text-gray-600 mb-4">Paste up to 100 contacts at a time in any format (e.g., CSV, space-separated) or upload multiple screenshots to extract phone numbers automatically from every line or comment. Phone numbers must include the country code (e.g., +233 for Ghana). The app will format to: name, phone/email, blank line. Repeat for up to 1000 total contacts.</p>
            <div class="example-box p-4 mb-4">
                <p class="font-semibold">Example Format (after auto-formatting):</p>
                <pre class="text-sm text-gray-700">
John Doe
+12025550123

Jane Smith
example@email.com
                </pre>
            </div>
            <div class="image-upload-container mb-4">
                <div id="imagePreviewContainer" class="image-preview-container"></div>
                <div class="upload-controls">
                    <label for="imageUpload" class="image-upload-label">Upload Screenshots</label>
                    <input type="file" id="imageUpload" class="image-upload-input" accept="image/*" multiple>
                    <button onclick="extractNumbersFromImages()" class="btn-primary bg-blue-600 text-white py-2 px-4 rounded-lg">Extract Numbers</button>
                </div>
            </div>
            <div id="fullScreenModal" class="modal">
                <img id="fullScreenImage" alt="Full Screen Preview">
                <div class="modal-close" onclick="closeFullScreen()">×</div>
            </div>
            <div class="mb-4">
                <label for="countrySelect" class="block text-gray-700 font-semibold mb-2">Select Country</label>
                <div class="custom-select">
                    <div class="custom-select-button" onclick="toggleDropdown()">
                        <img src="https://flagcdn.com/w20/us.png" alt="United States">
                        <span>United States (+1)</span>
                    </div>
                    <div id="countryDropdown" class="custom-select-dropdown">
                        <div class="custom-select-option" data-value="AF" data-calling-code="+93"><img src="https://flagcdn.com/w20/af.png" alt="Afghanistan"> Afghanistan (+93)</div>
                        <div class="custom-select-option" data-value="AL" data-calling-code="+355"><img src="https://flagcdn.com/w20/al.png" alt="Albania"> Albania (+355)</div>
                        <div class="custom-select-option" data-value="DZ" data-calling-code="+213"><img src="https://flagcdn.com/w20/dz.png" alt="Algeria"> Algeria (+213)</div>
                        <div class="custom-select-option" data-value="AD" data-calling-code="+376"><img src="https://flagcdn.com/w20/ad.png" alt="Andorra"> Andorra (+376)</div>
                        <div class="custom-select-option" data-value="AO" data-calling-code="+244"><img src="https://flagcdn.com/w20/ao.png" alt="Angola"> Angola (+244)</div>
                        <div class="custom-select-option" data-value="AG" data-calling-code="+1-268"><img src="https://flagcdn.com/w20/ag.png" alt="Antigua and Barbuda"> Antigua and Barbuda (+1-268)</div>
                        <div class="custom-select-option" data-value="AR" data-calling-code="+54"><img src="https://flagcdn.com/w20/ar.png" alt="Argentina"> Argentina (+54)</div>
                        <div class="custom-select-option" data-value="AM" data-calling-code="+374"><img src="https://flagcdn.com/w20/am.png" alt="Armenia"> Armenia (+374)</div>
                        <div class="custom-select-option" data-value="AU" data-calling-code="+61"><img src="https://flagcdn.com/w20/au.png" alt="Australia"> Australia (+61)</div>
                        <div class="custom-select-option" data-value="AT" data-calling-code="+43"><img src="https://flagcdn.com/w20/at.png" alt="Austria"> Austria (+43)</div>
                        <div class="custom-select-option" data-value="AZ" data-calling-code="+994"><img src="https://flagcdn.com/w20/az.png" alt="Azerbaijan"> Azerbaijan (+994)</div>
                        <div class="custom-select-option" data-value="BS" data-calling-code="+1-242"><img src="https://flagcdn.com/w20/bs.png" alt="Bahamas"> Bahamas (+1-242)</div>
                        <div class="custom-select-option" data-value="BH" data-calling-code="+973"><img src="https://flagcdn.com/w20/bh.png" alt="Bahrain"> Bahrain (+973)</div>
                        <div class="custom-select-option" data-value="BD" data-calling-code="+880"><img src="https://flagcdn.com/w20/bd.png" alt="Bangladesh"> Bangladesh (+880)</div>
                        <div class="custom-select-option" data-value="BB" data-calling-code="+1-246"><img src="https://flagcdn.com/w20/bb.png" alt="Barbados"> Barbados (+1-246)</div>
                        <div class="custom-select-option" data-value="BY" data-calling-code="+375"><img src="https://flagcdn.com/w20/by.png" alt="Belarus"> Belarus (+375)</div>
                        <div class="custom-select-option" data-value="BE" data-calling-code="+32"><img src="https://flagcdn.com/w20/be.png" alt="Belgium"> Belgium (+32)</div>
                        <div class="custom-select-option" data-value="BZ" data-calling-code="+501"><img src="https://flagcdn.com/w20/bz.png" alt="Belize"> Belize (+501)</div>
                        <div class="custom-select-option" data-value="BJ" data-calling-code="+229"><img src="https://flagcdn.com/w20/bj.png" alt="Benin"> Benin (+229)</div>
                        <div class="custom-select-option" data-value="BT" data-calling-code="+975"><img src="https://flagcdn.com/w20/bt.png" alt="Bhutan"> Bhutan (+975)</div>
                        <div class="custom-select-option" data-value="BO" data-calling-code="+591"><img src="https://flagcdn.com/w20/bo.png" alt="Bolivia"> Bolivia (+591)</div>
                        <div class="custom-select-option" data-value="BA" data-calling-code="+387"><img src="https://flagcdn.com/w20/ba.png" alt="Bosnia and Herzegovina"> Bosnia and Herzegovina (+387)</div>
                        <div class="custom-select-option" data-value="BW" data-calling-code="+267"><img src="https://flagcdn.com/w20/bw.png" alt="Botswana"> Botswana (+267)</div>
                        <div class="custom-select-option" data-value="BR" data-calling-code="+55"><img src="https://flagcdn.com/w20/br.png" alt="Brazil"> Brazil (+55)</div>
                        <div class="custom-select-option" data-value="BN" data-calling-code="+673"><img src="https://flagcdn.com/w20/bn.png" alt="Brunei"> Brunei (+673)</div>
                        <div class="custom-select-option" data-value="BG" data-calling-code="+359"><img src="https://flagcdn.com/w20/bg.png" alt="Bulgaria"> Bulgaria (+359)</div>
                        <div class="custom-select-option" data-value="BF" data-calling-code="+226"><img src="https://flagcdn.com/w20/bf.png" alt="Burkina Faso"> Burkina Faso (+226)</div>
                        <div class="custom-select-option" data-value="BI" data-calling-code="+257"><img src="https://flagcdn.com/w20/bi.png" alt="Burundi"> Burundi (+257)</div>
                        <div class="custom-select-option" data-value="CV" data-calling-code="+238"><img src="https://flagcdn.com/w20/cv.png" alt="Cabo Verde"> Cabo Verde (+238)</div>
                        <div class="custom-select-option" data-value="KH" data-calling-code="+855"><img src="https://flagcdn.com/w20/kh.png" alt="Cambodia"> Cambodia (+855)</div>
                        <div class="custom-select-option" data-value="CM" data-calling-code="+237"><img src="https://flagcdn.com/w20/cm.png" alt="Cameroon"> Cameroon (+237)</div>
                        <div class="custom-select-option" data-value="CA" data-calling-code="+1"><img src="https://flagcdn.com/w20/ca.png" alt="Canada"> Canada (+1)</div>
                        <div class="custom-select-option" data-value="CF" data-calling-code="+236"><img src="https://flagcdn.com/w20/cf.png" alt="Central African Republic"> Central African Republic (+236)</div>
                        <div class="custom-select-option" data-value="TD" data-calling-code="+235"><img src="https://flagcdn.com/w20/td.png" alt="Chad"> Chad (+235)</div>
                        <div class="custom-select-option" data-value="CL" data-calling-code="+56"><img src="https://flagcdn.com/w20/cl.png" alt="Chile"> Chile (+56)</div>
                        <div class="custom-select-option" data-value="CN" data-calling-code="+86"><img src="https://flagcdn.com/w20/cn.png" alt="China"> China (+86)</div>
                        <div class="custom-select-option" data-value="CO" data-calling-code="+57"><img src="https://flagcdn.com/w20/co.png" alt="Colombia"> Colombia (+57)</div>
                        <div class="custom-select-option" data-value="KM" data-calling-code="+269"><img src="https://flagcdn.com/w20/km.png" alt="Comoros"> Comoros (+269)</div>
                        <div class="custom-select-option" data-value="CG" data-calling-code="+242"><img src="https://flagcdn.com/w20/cg.png" alt="Congo"> Congo (+242)</div>
                        <div class="custom-select-option" data-value="CR" data-calling-code="+506"><img src="https://flagcdn.com/w20/cr.png" alt="Costa Rica"> Costa Rica (+506)</div>
                        <div class="custom-select-option" data-value="HR" data-calling-code="+385"><img src="https://flagcdn.com/w20/hr.png" alt="Croatia"> Croatia (+385)</div>
                        <div class="custom-select-option" data-value="CU" data-calling-code="+53"><img src="https://flagcdn.com/w20/cu.png" alt="Cuba"> Cuba (+53)</div>
                        <div class="custom-select-option" data-value="CY" data-calling-code="+357"><img src="https://flagcdn.com/w20/cy.png" alt="Cyprus"> Cyprus (+357)</div>
                        <div class="custom-select-option" data-value="CZ" data-calling-code="+420"><img src="https://flagcdn.com/w20/cz.png" alt="Czechia"> Czechia (+420)</div>
                        <div class="custom-select-option" data-value="CD" data-calling-code="+243"><img src="https://flagcdn.com/w20/cd.png" alt="Democratic Republic of the Congo"> Democratic Republic of the Congo (+243)</div>
                        <div class="custom-select-option" data-value="DK" data-calling-code="+45"><img src="https://flagcdn.com/w20/dk.png" alt="Denmark"> Denmark (+45)</div>
                        <div class="custom-select-option" data-value="DJ" data-calling-code="+253"><img src="https://flagcdn.com/w20/dj.png" alt="Djibouti"> Djibouti (+253)</div>
                        <div class="custom-select-option" data-value="DM" data-calling-code="+1-767"><img src="https://flagcdn.com/w20/dm.png" alt="Dominica"> Dominica (+1-767)</div>
                        <div class="custom-select-option" data-value="DO" data-calling-code="+1-809"><img src="https://flagcdn.com/w20/do.png" alt="Dominican Republic"> Dominican Republic (+1-809)</div>
                        <div class="custom-select-option" data-value="EC" data-calling-code="+593"><img src="https://flagcdn.com/w20/ec.png" alt="Ecuador"> Ecuador (+593)</div>
                        <div class="custom-select-option" data-value="EG" data-calling-code="+20"><img src="https://flagcdn.com/w20/eg.png" alt="Egypt"> Egypt (+20)</div>
                        <div class="custom-select-option" data-value="SV" data-calling-code="+503"><img src="https://flagcdn.com/w20/sv.png" alt="El Salvador"> El Salvador (+503)</div>
                        <div class="custom-select-option" data-value="GQ" data-calling-code="+240"><img src="https://flagcdn.com/w20/gq.png" alt="Equatorial Guinea"> Equatorial Guinea (+240)</div>
                        <div class="custom-select-option" data-value="ER" data-calling-code="+291"><img src="https://flagcdn.com/w20/er.png" alt="Eritrea"> Eritrea (+291)</div>
                        <div class="custom-select-option" data-value="EE" data-calling-code="+372"><img src="https://flagcdn.com/w20/ee.png" alt="Estonia"> Estonia (+372)</div>
                        <div class="custom-select-option" data-value="SZ" data-calling-code="+268"><img src="https://flagcdn.com/w20/sz.png" alt="Eswatini"> Eswatini (+268)</div>
                        <div class="custom-select-option" data-value="ET" data-calling-code="+251"><img src="https://flagcdn.com/w20/et.png" alt="Ethiopia"> Ethiopia (+251)</div>
                        <div class="custom-select-option" data-value="FJ" data-calling-code="+679"><img src="https://flagcdn.com/w20/fj.png" alt="Fiji"> Fiji (+679)</div>
                        <div class="custom-select-option" data-value="FI" data-calling-code="+358"><img src="https://flagcdn.com/w20/fi.png" alt="Finland"> Finland (+358)</div>
                        <div class="custom-select-option" data-value="FR" data-calling-code="+33"><img src="https://flagcdn.com/w20/fr.png" alt="France"> France (+33)</div>
                        <div class="custom-select-option" data-value="GA" data-calling-code="+241"><img src="https://flagcdn.com/w20/ga.png" alt="Gabon"> Gabon (+241)</div>
                        <div class="custom-select-option" data-value="GM" data-calling-code="+220"><img src="https://flagcdn.com/w20/gm.png" alt="Gambia"> Gambia (+220)</div>
                        <div class="custom-select-option" data-value="GE" data-calling-code="+995"><img src="https://flagcdn.com/w20/ge.png" alt="Georgia"> Georgia (+995)</div>
                        <div class="custom-select-option" data-value="DE" data-calling-code="+49"><img src="https://flagcdn.com/w20/de.png" alt="Germany"> Germany (+49)</div>
                        <div class="custom-select-option" data-value="GH" data-calling-code="+233"><img src="https://flagcdn.com/w20/gh.png" alt="Ghana"> Ghana (+233)</div>
                        <div class="custom-select-option" data-value="GR" data-calling-code="+30"><img src="https://flagcdn.com/w20/gr.png" alt="Greece"> Greece (+30)</div>
                        <div class="custom-select-option" data-value="GD" data-calling-code="+1-473"><img src="https://flagcdn.com/w20/gd.png" alt="Grenada"> Grenada (+1-473)</div>
                        <div class="custom-select-option" data-value="GT" data-calling-code="+502"><img src="https://flagcdn.com/w20/gt.png" alt="Guatemala"> Guatemala (+502)</div>
                        <div class="custom-select-option" data-value="GN" data-calling-code="+224"><img src="https://flagcdn.com/w20/gn.png" alt="Guinea"> Guinea (+224)</div>
                        <div class="custom-select-option" data-value="GW" data-calling-code="+245"><img src="https://flagcdn.com/w20/gw.png" alt="Guinea-Bissau"> Guinea-Bissau (+245)</div>
                        <div class="custom-select-option" data-value="GY" data-calling-code="+592"><img src="https://flagcdn.com/w20/gy.png" alt="Guyana"> Guyana (+592)</div>
                        <div class="custom-select-option" data-value="HT" data-calling-code="+509"><img src="https://flagcdn.com/w20/ht.png" alt="Haiti"> Haiti (+509)</div>
                        <div class="custom-select-option" data-value="HN" data-calling-code="+504"><img src="https://flagcdn.com/w20/hn.png" alt="Honduras"> Honduras (+504)</div>
                        <div class="custom-select-option" data-value="HU" data-calling-code="+36"><img src="https://flagcdn.com/w20/hu.png" alt="Hungary"> Hungary (+36)</div>
                        <div class="custom-select-option" data-value="IS" data-calling-code="+354"><img src="https://flagcdn.com/w20/is.png" alt="Iceland"> Iceland (+354)</div>
                        <div class="custom-select-option" data-value="IN" data-calling-code="+91"><img src="https://flagcdn.com/w20/in.png" alt="India"> India (+91)</div>
                        <div class="custom-select-option" data-value="ID" data-calling-code="+62"><img src="https://flagcdn.com/w20/id.png" alt="Indonesia"> Indonesia (+62)</div>
                        <div class="custom-select-option" data-value="IR" data-calling-code="+98"><img src="https://flagcdn.com/w20/ir.png" alt="Iran"> Iran (+98)</div>
                        <div class="custom-select-option" data-value="IQ" data-calling-code="+964"><img src="https://flagcdn.com/w20/iq.png" alt="Iraq"> Iraq (+964)</div>
                        <div class="custom-select-option" data-value="IE" data-calling-code="+353"><img src="https://flagcdn.com/w20/ie.png" alt="Ireland"> Ireland (+353)</div>
                        <div class="custom-select-option" data-value="IL" data-calling-code="+972"><img src="https://flagcdn.com/w20/il.png" alt="Israel"> Israel (+972)</div>
                        <div class="custom-select-option" data-value="IT" data-calling-code="+39"><img src="https://flagcdn.com/w20/it.png" alt="Italy"> Italy (+39)</div>
                        <div class="custom-select-option" data-value="JM" data-calling-code="+1-876"><img src="https://flagcdn.com/w20/jm.png" alt="Jamaica"> Jamaica (+1-876)</div>
                        <div class="custom-select-option" data-value="JP" data-calling-code="+81"><img src="https://flagcdn.com/w20/jp.png" alt="Japan"> Japan (+81)</div>
                        <div class="custom-select-option" data-value="JO" data-calling-code="+962"><img src="https://flagcdn.com/w20/jo.png" alt="Jordan"> Jordan (+962)</div>
                        <div class="custom-select-option" data-value="KZ" data-calling-code="+7"><img src="https://flagcdn.com/w20/kz.png" alt="Kazakhstan"> Kazakhstan (+7)</div>
                        <div class="custom-select-option" data-value="KE" data-calling-code="+254"><img src="https://flagcdn.com/w20/ke.png" alt="Kenya"> Kenya (+254)</div>
                        <div class="custom-select-option" data-value="KI" data-calling-code="+686"><img src="https://flagcdn.com/w20/ki.png" alt="Kiribati"> Kiribati (+686)</div>
                        <div class="custom-select-option" data-value="KW" data-calling-code="+965"><img src="https://flagcdn.com/w20/kw.png" alt="Kuwait"> Kuwait (+965)</div>
                        <div class="custom-select-option" data-value="KG" data-calling-code="+996"><img src="https://flagcdn.com/w20/kg.png" alt="Kyrgyzstan"> Kyrgyzstan (+996)</div>
                        <div class="custom-select-option" data-value="LA" data-calling-code="+856"><img src="https://flagcdn.com/w20/la.png" alt="Laos"> Laos (+856)</div>
                        <div class="custom-select-option" data-value="LV" data-calling-code="+371"><img src="https://flagcdn.com/w20/lv.png" alt="Latvia"> Latvia (+371)</div>
                        <div class="custom-select-option" data-value="LB" data-calling-code="+961"><img src="https://flagcdn.com/w20/lb.png" alt="Lebanon"> Lebanon (+961)</div>
                        <div class="custom-select-option" data-value="LS" data-calling-code="+266"><img src="https://flagcdn.com/w20/ls.png" alt="Lesotho"> Lesotho (+266)</div>
                        <div class="custom-select-option" data-value="LR" data-calling-code="+231"><img src="https://flagcdn.com/w20/lr.png" alt="Liberia"> Liberia (+231)</div>
                        <div class="custom-select-option" data-value="LY" data-calling-code="+218"><img src="https://flagcdn.com/w20/ly.png" alt="Libya"> Libya (+218)</div>
                        <div class="custom-select-option" data-value="LI" data-calling-code="+423"><img src="https://flagcdn.com/w20/li.png" alt="Liechtenstein"> Liechtenstein (+423)</div>
                        <div class="custom-select-option" data-value="LT" data-calling-code="+370"><img src="https://flagcdn.com/w20/lt.png" alt="Lithuania"> Lithuania (+370)</div>
                        <div class="custom-select-option" data-value="LU" data-calling-code="+352"><img src="https://flagcdn.com/w20/lu.png" alt="Luxembourg"> Luxembourg (+352)</div>
                        <div class="custom-select-option" data-value="MG" data-calling-code="+261"><img src="https://flagcdn.com/w20/mg.png" alt="Madagascar"> Madagascar (+261)</div>
                        <div class="custom-select-option" data-value="MW" data-calling-code="+265"><img src="https://flagcdn.com/w20/mw.png" alt="Malawi"> Malawi (+265)</div>
                        <div class="custom-select-option" data-value="MY" data-calling-code="+60"><img src="https://flagcdn.com/w20/my.png" alt="Malaysia"> Malaysia (+60)</div>
                        <div class="custom-select-option" data-value="MV" data-calling-code="+960"><img src="https://flagcdn.com/w20/mv.png" alt="Maldives"> Maldives (+960)</div>
                        <div class="custom-select-option" data-value="ML" data-calling-code="+223"><img src="https://flagcdn.com/w20/ml.png" alt="Mali"> Mali (+223)</div>
                        <div class="custom-select-option" data-value="MT" data-calling-code="+356"><img src="https://flagcdn.com/w20/mt.png" alt="Malta"> Malta (+356)</div>
                        <div class="custom-select-option" data-value="MH" data-calling-code="+692"><img src="https://flagcdn.com/w20/mh.png" alt="Marshall Islands"> Marshall Islands (+692)</div>
                        <div class="custom-select-option" data-value="MR" data-calling-code="+222"><img src="https://flagcdn.com/w20/mr.png" alt="Mauritania"> Mauritania (+222)</div>
                        <div class="custom-select-option" data-value="MU" data-calling-code="+230"><img src="https://flagcdn.com/w20/mu.png" alt="Mauritius"> Mauritius (+230)</div>
                        <div class="custom-select-option" data-value="MX" data-calling-code="+52"><img src="https://flagcdn.com/w20/mx.png" alt="Mexico"> Mexico (+52)</div>
                        <div class="custom-select-option" data-value="FM" data-calling-code="+691"><img src="https://flagcdn.com/w20/fm.png" alt="Micronesia"> Micronesia (+691)</div>
                        <div class="custom-select-option" data-value="MD" data-calling-code="+373"><img src="https://flagcdn.com/w20/md.png" alt="Moldova"> Moldova (+373)</div>
                        <div class="custom-select-option" data-value="MC" data-calling-code="+377"><img src="https://flagcdn.com/w20/mc.png" alt="Monaco"> Monaco (+377)</div>
                        <div class="custom-select-option" data-value="MN" data-calling-code="+976"><img src="https://flagcdn.com/w20/mn.png" alt="Mongolia"> Mongolia (+976)</div>
                        <div class="custom-select-option" data-value="ME" data-calling-code="+382"><img src="https://flagcdn.com/w20/me.png" alt="Montenegro"> Montenegro (+382)</div>
                        <div class="custom-select-option" data-value="MA" data-calling-code="+212"><img src="https://flagcdn.com/w20/ma.png" alt="Morocco"> Morocco (+212)</div>
                        <div class="custom-select-option" data-value="MZ" data-calling-code="+258"><img src="https://flagcdn.com/w20/mz.png" alt="Mozambique"> Mozambique (+258)</div>
                        <div class="custom-select-option" data-value="MM" data-calling-code="+95"><img src="https://flagcdn.com/w20/mm.png" alt="Myanmar"> Myanmar (+95)</div>
                        <div class="custom-select-option" data-value="NA" data-calling-code="+264"><img src="https://flagcdn.com/w20/na.png" alt="Namibia"> Namibia (+264)</div>
                        <div class="custom-select-option" data-value="NR" data-calling-code="+674"><img src="https://flagcdn.com/w20/nr.png" alt="Nauru"> Nauru (+674)</div>
                        <div class="custom-select-option" data-value="NP" data-calling-code="+977"><img src="https://flagcdn.com/w20/np.png" alt="Nepal"> Nepal (+977)</div>
                        <div class="custom-select-option" data-value="NL" data-calling-code="+31"><img src="https://flagcdn.com/w20/nl.png" alt="Netherlands"> Netherlands (+31)</div>
                        <div class="custom-select-option" data-value="NZ" data-calling-code="+64"><img src="https://flagcdn.com/w20/nz.png" alt="New Zealand"> New Zealand (+64)</div>
                        <div class="custom-select-option" data-value="NI" data-calling-code="+505"><img src="https://flagcdn.com/w20/ni.png" alt="Nicaragua"> Nicaragua (+505)</div>
                        <div class="custom-select-option" data-value="NE" data-calling-code="+227"><img src="https://flagcdn.com/w20/ne.png" alt="Niger"> Niger (+227)</div>
                        <div class="custom-select-option" data-value="NG" data-calling-code="+234"><img src="https://flagcdn.com/w20/ng.png" alt="Nigeria"> Nigeria (+234)</div>
                        <div class="custom-select-option" data-value="KP" data-calling-code="+850"><img src="https://flagcdn.com/w20/kp.png" alt="North Korea"> North Korea (+850)</div>
                        <div class="custom-select-option" data-value="MK" data-calling-code="+389"><img src="https://flagcdn.com/w20/mk.png" alt="North Macedonia"> North Macedonia (+389)</div>
                        <div class="custom-select-option" data-value="NO" data-calling-code="+47"><img src="https://flagcdn.com/w20/no.png" alt="Norway"> Norway (+47)</div>
                        <div class="custom-select-option" data-value="OM" data-calling-code="+968"><img src="https://flagcdn.com/w20/om.png" alt="Oman"> Oman (+968)</div>
                        <div class="custom-select-option" data-value="PK" data-calling-code="+92"><img src="https://flagcdn.com/w20/pk.png" alt="Pakistan"> Pakistan (+92)</div>
                        <div class="custom-select-option" data-value="PW" data-calling-code="+680"><img src="https://flagcdn.com/w20/pw.png" alt="Palau"> Palau (+680)</div>
                        <div class="custom-select-option" data-value="PS" data-calling-code="+970"><img src="https://flagcdn.com/w20/ps.png" alt="Palestine"> Palestine (+970)</div>
                        <div class="custom-select-option" data-value="PA" data-calling-code="+507"><img src="https://flagcdn.com/w20/pa.png" alt="Panama"> Panama (+507)</div>
                        <div class="custom-select-option" data-value="PG" data-calling-code="+675"><img src="https://flagcdn.com/w20/pg.png" alt="Papua New Guinea"> Papua New Guinea (+675)</div>
                        <div class="custom-select-option" data-value="PY" data-calling-code="+595"><img src="https://flagcdn.com/w20/py.png" alt="Paraguay"> Paraguay (+595)</div>
                        <div class="custom-select-option" data-value="PE" data-calling-code="+51"><img src="https://flagcdn.com/w20/pe.png" alt="Peru"> Peru (+51)</div>
                        <div class="custom-select-option" data-value="PH" data-calling-code="+63"><img src="https://flagcdn.com/w20/ph.png" alt="Philippines"> Philippines (+63)</div>
                        <div class="custom-select-option" data-value="PL" data-calling-code="+48"><img src="https://flagcdn.com/w20/pl.png" alt="Poland"> Poland (+48)</div>
                        <div class="custom-select-option" data-value="PT" data-calling-code="+351"><img src="https://flagcdn.com/w20/pt.png" alt="Portugal"> Portugal (+351)</div>
                        <div class="custom-select-option" data-value="QA" data-calling-code="+974"><img src="https://flagcdn.com/w20/qa.png" alt="Qatar"> Qatar (+974)</div>
                        <div class="custom-select-option" data-value="RO" data-calling-code="+40"><img src="https://flagcdn.com/w20/ro.png" alt="Romania"> Romania (+40)</div>
                        <div class="custom-select-option" data-value="RU" data-calling-code="+7"><img src="https://flagcdn.com/w20/ru.png" alt="Russia"> Russia (+7)</div>
                        <div class="custom-select-option" data-value="RW" data-calling-code="+250"><img src="https://flagcdn.com/w20/rw.png" alt="Rwanda"> Rwanda (+250)</div>
                        <div class="custom-select-option" data-value="KN" data-calling-code="+1-869"><img src="https://flagcdn.com/w20/kn.png" alt="Saint Kitts and Nevis"> Saint Kitts and Nevis (+1-869)</div>
                        <div class="custom-select-option" data-value="LC" data-calling-code="+1-758"><img src="https://flagcdn.com/w20/lc.png" alt="Saint Lucia"> Saint Lucia (+1-758)</div>
                        <div class="custom-select-option" data-value="VC" data-calling-code="+1-784"><img src="https://flagcdn.com/w20/vc.png" alt="Saint Vincent and the Grenadines"> Saint Vincent and the Grenadines (+1-784)</div>
                        <div class="custom-select-option" data-value="WS" data-calling-code="+685"><img src="https://flagcdn.com/w20/ws.png" alt="Samoa"> Samoa (+685)</div>
                        <div class="custom-select-option" data-value="SM" data-calling-code="+378"><img src="https://flagcdn.com/w20/sm.png" alt="San Marino"> San Marino (+378)</div>
                        <div class="custom-select-option" data-value="ST" data-calling-code="+239"><img src="https://flagcdn.com/w20/st.png" alt="Sao Tome and Principe"> Sao Tome and Principe (+239)</div>
                        <div class="custom-select-option" data-value="SA" data-calling-code="+966"><img src="https://flagcdn.com/w20/sa.png" alt="Saudi Arabia"> Saudi Arabia (+966)</div>
                        <div class="custom-select-option" data-value="SN" data-calling-code="+221"><img src="https://flagcdn.com/w20/sn.png" alt="Senegal"> Senegal (+221)</div>
                        <div class="custom-select-option" data-value="RS" data-calling-code="+381"><img src="https://flagcdn.com/w20/rs.png" alt="Serbia"> Serbia (+381)</div>
                        <div class="custom-select-option" data-value="SC" data-calling-code="+248"><img src="https://flagcdn.com/w20/sc.png" alt="Seychelles"> Seychelles (+248)</div>
                        <div class="custom-select-option" data-value="SL" data-calling-code="+232"><img src="https://flagcdn.com/w20/sl.png" alt="Sierra Leone"> Sierra Leone (+232)</div>
                        <div class="custom-select-option" data-value="SG" data-calling-code="+65"><img src="https://flagcdn.com/w20/sg.png" alt="Singapore"> Singapore (+65)</div>
                        <div class="custom-select-option" data-value="SK" data-calling-code="+421"><img src="https://flagcdn.com/w20/sk.png" alt="Slovakia"> Slovakia (+421)</div>
                        <div class="custom-select-option" data-value="SI" data-calling-code="+386"><img src="https://flagcdn.com/w20/si.png" alt="Slovenia"> Slovenia (+386)</div>
                        <div class="custom-select-option" data-value="SB" data-calling-code="+677"><img src="https://flagcdn.com/w20/sb.png" alt="Solomon Islands"> Solomon Islands (+677)</div>
                        <div class="custom-select-option" data-value="SO" data-calling-code="+252"><img src="https://flagcdn.com/w20/so.png" alt="Somalia"> Somalia (+252)</div>
                        <div class="custom-select-option" data-value="ZA" data-calling-code="+27"><img src="https://flagcdn.com/w20/za.png" alt="South Africa"> South Africa (+27)</div>
                        <div class="custom-select-option" data-value="KR" data-calling-code="+82"><img src="https://flagcdn.com/w20/kr.png" alt="South Korea"> South Korea (+82)</div>
                        <div class="custom-select-option" data-value="SS" data-calling-code="+211"><img src="https://flagcdn.com/w20/ss.png" alt="South Sudan"> South Sudan (+211)</div>
                        <div class="custom-select-option" data-value="ES" data-calling-code="+34"><img src="https://flagcdn.com/w20/es.png" alt="Spain"> Spain (+34)</div>
                        <div class="custom-select-option" data-value="LK" data-calling-code="+94"><img src="https://flagcdn.com/w20/lk.png" alt="Sri Lanka"> Sri Lanka (+94)</div>
                        <div class="custom-select-option" data-value="SD" data-calling-code="+249"><img src="https://flagcdn.com/w20/sd.png" alt="Sudan"> Sudan (+249)</div>
                        <div class="custom-select-option" data-value="SR" data-calling-code="+597"><img src="https://flagcdn.com/w20/sr.png" alt="Suriname"> Suriname (+597)</div>
                        <div class="custom-select-option" data-value="SE" data-calling-code="+46"><img src="https://flagcdn.com/w20/se.png" alt="Sweden"> Sweden (+46)</div>
                        <div class="custom-select-option" data-value="CH" data-calling-code="+41"><img src="https://flagcdn.com/w20/ch.png" alt="Switzerland"> Switzerland (+41)</div>
                        <div class="custom-select-option" data-value="SY" data-calling-code="+963"><img src="https://flagcdn.com/w20/sy.png" alt="Syria"> Syria (+963)</div>
                        <div class="custom-select-option" data-value="TW" data-calling-code="+886"><img src="https://flagcdn.com/w20/tw.png" alt="Taiwan"> Taiwan (+886)</div>
                        <div class="custom-select-option" data-value="TJ" data-calling-code="+992"><img src="https://flagcdn.com/w20/tj.png" alt="Tajikistan"> Tajikistan (+992)</div>
                        <div class="custom-select-option" data-value="TZ" data-calling-code="+255"><img src="https://flagcdn.com/w20/tz.png" alt="Tanzania"> Tanzania (+255)</div>
                        <div class="custom-select-option" data-value="TH" data-calling-code="+66"><img src="https://flagcdn.com/w20/th.png" alt="Thailand"> Thailand (+66)</div>
                        <div class="custom-select-option" data-value="TL" data-calling-code="+670"><img src="https://flagcdn.com/w20/tl.png" alt="Timor-Leste"> Timor-Leste (+670)</div>
                        <div class="custom-select-option" data-value="TG" data-calling-code="+228"><img src="https://flagcdn.com/w20/tg.png" alt="Togo"> Togo (+228)</div>
                        <div class="custom-select-option" data-value="TO" data-calling-code="+676"><img src="https://flagcdn.com/w20/to.png" alt="Tonga"> Tonga (+676)</div>
                        <div class="custom-select-option" data-value="TT" data-calling-code="+1-868"><img src="https://flagcdn.com/w20/tt.png" alt="Trinidad and Tobago"> Trinidad and Tobago (+1-868)</div>
                        <div class="custom-select-option" data-value="TN" data-calling-code="+216"><img src="https://flagcdn.com/w20/tn.png" alt="Tunisia"> Tunisia (+216)</div>
                        <div class="custom-select-option" data-value="TR" data-calling-code="+90"><img src="https://flagcdn.com/w20/tr.png" alt="Turkey"> Turkey (+90)</div>
                        <div class="custom-select-option" data-value="TM" data-calling-code="+993"><img src="https://flagcdn.com/w20/tm.png" alt="Turkmenistan"> Turkmenistan (+993)</div>
                        <div class="custom-select-option" data-value="TV" data-calling-code="+688"><img src="https://flagcdn.com/w20/tv.png" alt="Tuvalu"> Tuvalu (+688)</div>
                        <div class="custom-select-option" data-value="UG" data-calling-code="+256"><img src="https://flagcdn.com/w20/ug.png" alt="Uganda"> Uganda (+256)</div>
                        <div class="custom-select-option" data-value="UA" data-calling-code="+380"><img src="https://flagcdn.com/w20/ua.png" alt="Ukraine"> Ukraine (+380)</div>
                        <div class="custom-select-option" data-value="AE" data-calling-code="+971"><img src="https://flagcdn.com/w20/ae.png" alt="United Arab Emirates"> United Arab Emirates (+971)</div>
                        <div class="custom-select-option" data-value="GB" data-calling-code="+44"><img src="https://flagcdn.com/w20/gb.png" alt="United Kingdom"> United Kingdom (+44)</div>
                        <div class="custom-select-option" data-value="US" data-calling-code="+1"><img src="https://flagcdn.com/w20/us.png" alt="United States"> United States (+1)</div>
                        <div class="custom-select-option" data-value="UY" data-calling-code="+598"><img src="https://flagcdn.com/w20/uy.png" alt="Uruguay"> Uruguay (+598)</div>
                        <div class="custom-select-option" data-value="UZ" data-calling-code="+998"><img src="https://flagcdn.com/w20/uz.png" alt="Uzbekistan"> Uzbekistan (+998)</div>
                        <div class="custom-select-option" data-value="VU" data-calling-code="+678"><img src="https://flagcdn.com/w20/vu.png" alt="Vanuatu"> Vanuatu (+678)</div>
                        <div class="custom-select-option" data-value="VE" data-calling-code="+58"><img src="https://flagcdn.com/w20/ve.png" alt="Venezuela"> Venezuela (+58)</div>
                        <div class="custom-select-option" data-value="VN" data-calling-code="+84"><img src="https://flagcdn.com/w20/vn.png" alt="Vietnam"> Vietnam (+84)</div>
                        <div class="custom-select-option" data-value="YE" data-calling-code="+967"><img src="https://flagcdn.com/w20/ye.png" alt="Yemen"> Yemen (+967)</div>
                        <div class="custom-select-option" data-value="ZM" data-calling-code="+260"><img src="https://flagcdn.com/w20/zm.png" alt="Zambia"> Zambia (+260)</div>
                        <div class="custom-select-option" data-value="ZW" data-calling-code="+263"><img src="https://flagcdn.com/w20/zw.png" alt="Zimbabwe"> Zimbabwe (+263)</div>
                    </div>
                    <input type="hidden" id="countrySelect" value="US">
                    <input type="hidden" id="countryCallingCode" value="+1">
                </div>
            </div>
            <textarea id="contactInput" class="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Paste your contacts here (e.g., CSV, space-separated) or upload screenshots above..."></textarea>
            <button onclick="generateVCF()" class="btn-primary w-full mt-4 bg-blue-600 text-white py-3 rounded-lg font-semibold">Generate & Download Contacts (.vcf)</button>
        </div>
        <div id="output" class="output text-center text-gray-700"></div>
        <div class="chatbot-container">
            <div class="chatbot-toggle" onclick="toggleChatbot()">💬</div>
            <div id="chatbotWindow" class="chatbot-window">
                <div class="chatbot-header">Contact Importer Help</div>
                <div id="chatbotMessages" class="chatbot-messages">
                    <div class="chatbot-message bot">Welcome! I'm here to answer any questions about the LYFER PROCONTACT IMPORTER or anything else. Ask away!</div>
                </div>
                <div class="chatbot-input">
                    <input id="chatbotInput" type="text" placeholder="Type your question...">
                    <button onclick="sendChatbotMessage()">Send</button>
                </div>
            </div>
        </div>
        <div class="footer">
            <p>&copy; 2025 LYFER PROCONTACT IMPORTER. All rights reserved.</p>
        </div>
        <div id="fullScreenModal" class="modal">
            <img id="fullScreenImage" alt="Full Screen Preview">
            <div class="modal-close" onclick="closeFullScreen()">×</div>
        </div>
        <div id="loadingOverlay" class="loading-overlay">
            <div class="loading-content">
                <div class="spinner"></div>
                <p class="text-gray-700">Processing images...</p>
            </div>
        </div>
    </div>
    <script>
        let uploadedImages = [];
        function toggleDropdown() {
            const dropdown = document.getElementById('countryDropdown');
            dropdown.classList.toggle('show');
        }
        function selectCountry(countryCode, countryName, callingCode) {
            const button = document.querySelector('.custom-select-button');
            const flagImg = button.querySelector('img');
            const text = button.querySelector('span');
            const countrySelect = document.getElementById('countrySelect');
            const countryCallingCode = document.getElementById('countryCallingCode');
            flagImg.src = `https://flagcdn.com/w20/${countryCode.toLowerCase()}.png`;
            flagImg.alt = countryName;
            text.textContent = `${countryName} (${callingCode})`;
            countrySelect.value = countryCode;
            countryCallingCode.value = callingCode;
            document.getElementById('countryDropdown').classList.remove('show');
            reformatContacts();
        }
        document.querySelectorAll('.custom-select-option').forEach(option => {
            option.addEventListener('click', () => {
                const countryCode = option.getAttribute('data-value');
                const countryName = option.textContent.split(' (')[0].trim();
                const callingCode = option.getAttribute('data-calling-code');
                selectCountry(countryCode, countryName, callingCode);
            });
        });
        document.addEventListener('click', (event) => {
            const dropdown = document.getElementById('countryDropdown');
            const button = document.querySelector('.custom-select-button');
            if (!button.contains(event.target) && !dropdown.contains(event.target)) {
                dropdown.classList.remove('show');
            }
        });
        document.getElementById('imageUpload').addEventListener('change', (event) => {
            const files = Array.from(event.target.files);
            const previewContainer = document.getElementById('imagePreviewContainer');
            const output = document.getElementById('output');
            files.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const imgId = `imagePreview_${uploadedImages.length + index}`;
                    const imgData = { id: imgId, src: e.target.result };
                    uploadedImages.push(imgData);
                    const previewItem = document.createElement('div');
                    previewItem.className = 'image-preview-item';
                    previewItem.innerHTML = `
                        <img id="${imgId}" class="image-preview" src="${e.target.result}" alt="Image Preview" onclick="openFullScreen('${imgId}')">
                        <div class="delete-button" onclick="deleteImage('${imgId}')">🗑️</div>
                    `;
                    previewContainer.appendChild(previewItem);
                };
                reader.readAsDataURL(file);
            });
            output.innerHTML = `<p class="text-blue-600">${files.length} image(s) uploaded. Tap an image to view full screen, "Extract Numbers" to process, or the trash icon to delete.</p>`;
            event.target.value = '';
        });
        function deleteImage(imgId) {
            uploadedImages = uploadedImages.filter(img => img.id !== imgId);
            const previewItem = document.querySelector(`#${imgId}`).parentElement;
            previewItem.remove();
            const output = document.getElementById('output');
            output.innerHTML = uploadedImages.length > 0
                ? `<p class="text-blue-600">Image deleted. ${uploadedImages.length} image(s) remaining. Tap an image to view full screen, "Extract Numbers" to process, or the trash icon to delete.</p>`
                : `<p class="text-blue-600">All images deleted. Upload new images to extract phone numbers.</p>`;
        }
        function openFullScreen(imgId) {
            const modal = document.getElementById('fullScreenModal');
            const fullScreenImage = document.getElementById('fullScreenImage');
            const imgData = uploadedImages.find(img => img.id === imgId);
            if (imgData) {
                fullScreenImage.src = imgData.src;
                modal.classList.add('show');
            }
        }
        function closeFullScreen() {
            const modal = document.getElementById('fullScreenModal');
            modal.classList.remove('show');
        }
        async function extractNumbersFromImages() {
            const output = document.getElementById('output');
            const contactInput = document.getElementById('contactInput');
            const callingCode = document.getElementById('countryCallingCode').value;
            const countryCode = document.getElementById('countrySelect').value;
            const loadingOverlay = document.getElementById('loadingOverlay');
            if (uploadedImages.length === 0) {
                output.innerHTML = '<p class="text-red-500">Please upload at least one image first.</p>';
                return;
            }
            loadingOverlay.classList.add('show');
            output.innerHTML = '';
            let allPhoneNumbers = [];
            let errorCount = 0;
            const phoneRegex = new RegExp(`\\${callingCode}\\d{7,}\\b`, 'g');
            const ghanaLocalRegex = /\b0\d{7,9}\b/g; // For Ghana, match numbers like 0241234567
            // Timeout wrapper for Tesseract processing
            const withTimeout = (promise, timeoutMs) => {
                return new Promise((resolve, reject) => {
                    const timeout = setTimeout(() => {
                        reject(new Error('OCR processing timed out'));
                    }, timeoutMs);
                    promise.then(
                        (result) => {
                            clearTimeout(timeout);
                            resolve(result);
                        },
                        (error) => {
                            clearTimeout(timeout);
                            reject(error);
                        }
                    );
                });
            };
            // Process images in parallel
            const processImage = async (imgData) => {
                try {
                    const { data: { text } } = await withTimeout(
                        Tesseract.recognize(imgData.src, 'eng', {
                            logger: (m) => console.log(m),
                        }),
                        60000 // 60 seconds per image
                    );
                    const lines = text.split('\n').map(line => line.trim()).filter(line => line);
                    let phoneNumbers = [];
                    lines.forEach((line) => {
                        // Match numbers with the country code
                        const matches = line.match(phoneRegex) || [];
                        matches.forEach(phone => {
                            const cleaned = phone.replace(/[^0-9+]/g, '');
                            if (cleaned.startsWith(callingCode) && cleaned.length >= callingCode.length + 7) {
                                phoneNumbers.push(cleaned);
                            }
                        });
                        // For Ghana only, match local numbers starting with 0
                        if (countryCode === 'GH') {
                            const localMatches = line.match(ghanaLocalRegex) || [];
                            localMatches.forEach(phone => {
                                const cleaned = phone.replace(/[^0-9]/g, '').replace(/^0/, '');
                                if (cleaned.length >= 7 && cleaned.length <= 9) {
                                    phoneNumbers.push(`+233${cleaned}`);
                                }
                            });
                        }
                    });
                    return [...new Set(phoneNumbers)];
                } catch (error) {
                    console.error('OCR Error for image', imgData.id, ':', error.message);
                    return { error: true, id: imgData.id };
                }
            };
            // Run all image processing in parallel
            const results = await Promise.all(uploadedImages.map(processImage));
            // Collect results
            results.forEach(result => {
                if (result.error) {
                    errorCount++;
                } else {
                    allPhoneNumbers.push(...result);
                }
            });
            allPhoneNumbers = [...new Set(allPhoneNumbers)]; // Remove duplicates
            loadingOverlay.classList.remove('show');
            if (allPhoneNumbers.length === 0) {
                output.innerHTML = `<p class="text-red-500">No valid phone numbers with country code ${callingCode}${countryCode === 'GH' ? ' or local format (0xxxxxxxx)' : ''} found in the image(s). ${errorCount > 0 ? `${errorCount} image(s) failed to process, possibly due to timeout or unreadable text.` : ''}</p>`;
                return;
            }
            // Auto-format to match site format: name, phone, blank line
            let formattedText = contactInput.value ? `${contactInput.value}\n\n` : '';
            allPhoneNumbers.forEach((phone, index) => {
                formattedText += `Contact ${index + 1}\n${phone}\n\n`;
            });
            contactInput.value = formattedText.trim();
            output.innerHTML = `<p class="text-green-600">Extracted and formatted ${allPhoneNumbers.length} valid phone numbers from ${uploadedImages.length} image(s) into required format (name, phone, blank line). ${errorCount > 0 ? `${errorCount} image(s) failed to process.` : ''} Ready to generate VCF. Tap "Generate & Download".</p>`;
            reformatContacts();
        }
        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }
        function normalizePhoneNumber(phone, callingCode) {
            const cleaned = phone.replace(/[^0-9+]/g, '');
            if (cleaned.startsWith(callingCode) && cleaned.length >= callingCode.length + 7) {
                return cleaned;
            }
            return '';
        }
        function reformatContacts() {
            const contactInput = document.getElementById('contactInput');
            const currentText = contactInput.value.trim();
            const callingCode = document.getElementById('countryCallingCode').value;
            const countryCode = document.getElementById('countrySelect').value;
            const output = document.getElementById('output');
            if (!currentText) {
                output.innerHTML = '';
                return;
            }
            const lines = currentText.split('\n').map(item => item.trim()).filter(item => item);
            const contacts = [];
            let currentContact = { name: '', contact: '' };
            let expectingContact = false;
            const phoneRegex = new RegExp(`\\${callingCode}\\d{7,}\\b`, 'g');
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            const ghanaLocalRegex = /\b0\d{7,9}\b/g; // For Ghana local numbers
            for (let item of lines) {
                if (!item) {
                    if (currentContact.name && currentContact.contact) {
                        contacts.push({ ...currentContact });
                        currentContact = { name: '', contact: '' };
                        expectingContact = false;
                    }
                    continue;
                }
                const parts = item.split(/[,;\t]+|\s{2,}/).map(p => p.trim()).filter(p => p);
                if (parts.length >= 2) {
                    let name = parts[0];
                    let contact = parts.slice(1).join(' ').trim();
                    if (emailRegex.test(contact)) {
                        currentContact.name = name;
                        currentContact.contact = contact;
                        contacts.push({ ...currentContact });
                        currentContact = { name: '', contact: '' };
                        expectingContact = false;
                    } else {
                        let phone = normalizePhoneNumber(contact, callingCode);
                        if (!phone && countryCode === 'GH') {
                            const localMatch = contact.match(ghanaLocalRegex);
                            if (localMatch) {
                                const cleaned = localMatch[0].replace(/[^0-9]/g, '').replace(/^0/, '');
                                if (cleaned.length >= 7 && cleaned.length <= 9) {
                                    phone = `+233${cleaned}`;
                                }
                            }
                        }
                        if (phone) {
                            currentContact.name = name;
                            currentContact.contact = phone;
                            contacts.push({ ...currentContact });
                            currentContact = { name: '', contact: '' };
                            expectingContact = false;
                        } else {
                            currentContact.name = name;
                            expectingContact = true;
                        }
                    }
                } else if (expectingContact) {
                    if (emailRegex.test(item)) {
                        currentContact.contact = item;
                        contacts.push({ ...currentContact });
                        currentContact = { name: '', contact: '' };
                        expectingContact = false;
                    } else {
                        let phone = normalizePhoneNumber(item, callingCode);
                        if (!phone && countryCode === 'GH') {
                            const localMatch = item.match(ghanaLocalRegex);
                            if (localMatch) {
                                const cleaned = localMatch[0].replace(/[^0-9]/g, '').replace(/^0/, '');
                                if (cleaned.length >= 7 && cleaned.length <= 9) {
                                    phone = `+233${cleaned}`;
                                }
                            }
                        }
                        if (phone) {
                            currentContact.contact = phone;
                            contacts.push({ ...currentContact });
                            currentContact = { name: '', contact: '' };
                            expectingContact = false;
                        } else {
                            currentContact = { name: item, contact: '' };
                            expectingContact = true;
                        }
                    }
                } else {
                    currentContact.name = item;
                    expectingContact = true;
                }
            }
            if (currentContact.name && currentContact.contact) {
                contacts.push({ ...currentContact });
            }
            let formattedText = '';
            let validContacts = 0;
            for (const contact of contacts) {
                if (contact.name && contact.contact) {
                    formattedText += `${contact.name}\n${contact.contact}\n\n`;
                    validContacts++;
                }
            }
            contactInput.value = formattedText.trim();
            if (validContacts > 0) {
                output.innerHTML = `<p class="text-blue-600">Reformatted ${validContacts} valid contacts to match required format (name, phone/email, blank line). Review and tap "Generate & Download".</p>`;
            } else {
                output.innerHTML = `<p class="text-red-500">No valid contacts found. Ensure each contact has a name and a phone number with country code ${callingCode} or an email.</p>`;
            }
        }
        document.getElementById('contactInput').addEventListener('paste', (event) => {
            event.preventDefault();
            const pastedData = (event.clipboardData || window.clipboardData).getData('text');
            const contactInput = document.getElementById('contactInput');
            contactInput.value = pastedData;
            setTimeout(reformatContacts, 0);
        });
        document.getElementById('contactInput').addEventListener('input', () => {
            clearTimeout(window.reformatTimeout);
            window.reformatTimeout = setTimeout(reformatContacts, 500);
        });
        let contactCounter = 1;
        function generateVCF() {
            const input = document.getElementById('contactInput').value.trim();
            const output = document.getElementById('output');
            const country = document.getElementById('countrySelect').value;
            const callingCode = document.getElementById('countryCallingCode').value;
            if (!input) {
                output.innerHTML = '<p class="text-red-500">Please paste some contacts or upload images first!</p>';
                return;
            }
            const blocks = input.split(/\n\s*\n/).map(block => block.trim()).filter(block => block);
            if (blocks.length === 0) {
                output.innerHTML = '<p class="text-red-500">No contacts to process.</p>';
                return;
            }
            const firstBlock = blocks[0];
            const firstBlockLines = firstBlock.split('\n').map(l => l.trim()).filter(l => l);
            if (firstBlockLines.length !== 2) {
                output.innerHTML = '<p class="text-red-500">Invalid format for first contact. Needs name and phone/email.</p>';
                return;
            }
            const name = firstBlockLines[0];
            let contactValue = firstBlockLines[1];
            let isEmail = isValidEmail(contactValue);
            let isPhone = false;
            if (!isEmail) {
                contactValue = normalizePhoneNumber(contactValue, callingCode);
                if (contactValue) isPhone = true;
            }
            if (!isEmail && !isPhone) {
                output.innerHTML = `<p class="text-red-500">Invalid contact for "${name}": Must be email or phone with ${callingCode}.</p>`;
                return;
            }
            let vcfContent = `BEGIN:VCARD
VERSION:3.0
FN:${name}
${isEmail ? `EMAIL:${contactValue}` : `TEL:${contactValue}`}
ADR;TYPE=HOME:;;;${country};;;
END:VCARD
`;
            const blob = new Blob([vcfContent], { type: 'text/vcard' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `contact${contactCounter}.vcf`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            const remainingBlocks = blocks.slice(1);
            let remaining = remainingBlocks.length;
            contactInput.value = remainingBlocks.join('\n\n');
            if (remaining > 0) contactInput.value += '\n\n';
            let message = `Success! Downloaded contact${contactCounter}.vcf with 1 contact. `;
            contactCounter++;
            if (remaining > 0) {
                message += `${remaining} contact${remaining === 1 ? '' : 's'} remaining. Click again for next.`;
            } else {
                message += 'All contacts processed.';
            }
            output.innerHTML = `<p class="text-green-600">${message}</p>`;
        }
        function toggleChatbot() {
            const chatbotWindow = document.getElementById('chatbotWindow');
            chatbotWindow.classList.toggle('show');
        }
        async function sendChatbotMessage() {
            const input = document.getElementById('chatbotInput');
            const messages = document.getElementById('chatbotMessages');
            const question = input.value.trim();
            if (!question) return;
            const userMessage = document.createElement('div');
            userMessage.className = 'chatbot-message user';
            userMessage.textContent = question;
            messages.appendChild(userMessage);
            let botResponse = "Sorry, I'm having trouble connecting to the AI service. Please try again or ask about the LYFER PROCONTACT IMPORTER for more specific help.";
            if (question.toLowerCase().includes('how to use') || question.toLowerCase().includes('how does it work')) {
                botResponse = "To use the LYFER PROCONTACT IMPORTER, paste up to 100 contacts in any format (e.g., CSV, space-separated) into the textarea or upload multiple screenshots to extract phone numbers from every line or comment. Select a country to apply the correct country code. Phone numbers must include the selected country code (e.g., +233 for Ghana). Compact image previews (100px wide) appear above the upload and extract buttons. Click an image to view it full screen, 'Extract Numbers' to process all images (a loading screen will appear), or the trash icon to delete an image. Click 'Generate & Download Contacts (.vcf)' to create a .vcf file, which you can open in your phone's Contacts app to import.";
            } else if (question.toLowerCase().includes('country code') || question.toLowerCase().includes('phone number format')) {
                botResponse = "Select a country from the dropdown to set the country code (e.g., +233 for Ghana, +1 for the US). The app ensures phone numbers include the selected country code and contain only digits afterward.";
            } else if (question.toLowerCase().includes('how many contacts') || question.toLowerCase().includes('limit')) {
                botResponse = "You can paste or extract up to 100 contacts at a time (200 lines, with each contact needing a name and a phone number with the selected country code or an email). Repeat the process for up to 1000 contacts in total.";
            } else if (question.toLowerCase().includes('vcf') || question.toLowerCase().includes('what is vcf')) {
                botResponse = "A .vcf file is a vCard file that stores contact information. The app generates a .vcf file from your contacts or extracted phone numbers, which you can open in your phone's Contacts app to import.";
            } else if (question.toLowerCase().includes('supported devices') || question.toLowerCase().includes('iphone') || question.toLowerCase().includes('android')) {
                botResponse = "The LYFER PROCONTACT IMPORTER works with both iPhone and Android. The generated .vcf file is compatible with the Contacts app on both platforms.";
            } else if (question.toLowerCase().includes('screenshot') || question.toLowerCase().includes('image upload') || question.toLowerCase().includes('extract numbers')) {
                botResponse = "Upload multiple screenshots using the 'Upload Screenshots' button. Compact previews (100px wide) appear above the buttons. Click an image to view it full screen, 'Extract Numbers' to detect phone numbers with the selected country code from every line or comment in all images (a loading screen will appear), or use the trash icon to delete an image.";
            } else if (question.toLowerCase().includes('delete image') || question.toLowerCase().includes('remove image') || question.toLowerCase().includes('trash icon')) {
                botResponse = "To delete an uploaded image, click the trash can icon (🗑️) on the top-right corner of its compact preview above the upload and extract buttons.";
            } else if (question.toLowerCase().includes('phone number length') || question.toLowerCase().includes('digits')) {
                botResponse = "The app extracts phone numbers that include the selected country code (e.g., +233 for Ghana) followed by digits, with no strict length requirement, from every line or comment in the screenshots or pasted text.";
            } else if (question.toLowerCase().includes('full screen') || question.toLowerCase().includes('view image')) {
                botResponse = "Click a compact image preview (100px wide, above the upload and extract buttons) to view that screenshot in full screen. Click the '×' button in the top-right corner to close the full-screen view.";
            }
            const botMessage = document.createElement('div');
            botMessage.className = 'chatbot-message bot';
            botMessage.textContent = botResponse;
            messages.appendChild(botMessage);
            messages.scrollTop = messages.scrollHeight;
            input.value = '';
        }
    </script>
</body>
</html>